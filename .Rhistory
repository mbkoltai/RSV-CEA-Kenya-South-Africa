dim(config$rsv_rate,s_afr_incid_rate_matrix))
dim(rbind(config$rsv_rate,s_afr_incid_rate_matrix))
colnames(s_afr_incid_rate_matrix)
colnames(config$rsv_rate)
z=config$rsv_rate; colnames(z)<-NULL
safr_rsv_incid_mcmarcel=melt(data.frame(rbind(z,s_afr_incid_rate_matrix),
source=array(sapply(c('mcmarcel','kemri'),function(x) {rep(x,age_maxval)})),age_mts=rep(1:age_maxval,2)),
id.vars='age_mts')
dim(rbind(z,s_afr_incid_rate_matrix))
dim(z)
dim(s_afr_incid_rate_matrix)
class(s_afr_incid_rate_matrix)
dim(rbind(z,s_afr_incid_rate_matrix))
dim(rbind(data.frame(z),data.frame(s_afr_incid_rate_matrix)))
dim(rbind(data.frame(z),data.frame(s_afr_incid_rate_matrix)))
safr_rsv_incid_mcmarcel=melt(data.frame(rbind(data.frame(z),data.frame(s_afr_incid_rate_matrix)),
source=array(sapply(c('mcmarcel','kemri'),function(x) {rep(x,age_maxval)})),age_mts=rep(1:age_maxval,2)),
id.vars='age_mts')
safr_rsv_incid_mcmarcel=melt(data.frame(rbind(data.frame(config$rsv_rate),data.frame(s_afr_incid_rate_matrix)),
source=array(sapply(c('mcmarcel','kemri'),function(x) {rep(x,age_maxval)})),age_mts=rep(1:age_maxval,2)),
id.vars='age_mts');
rm(z)
safr_rsv_incid_mcmarcel_kemri=melt(data.frame(rbind(data.frame(config$rsv_rate),data.frame(s_afr_incid_rate_matrix)),
source=array(sapply(c('mcmarcel','kemri'),function(x) {rep(x,age_maxval)})),age_mts=rep(1:age_maxval,2)),
id.vars='age_mts');
rm(safr_rsv_incid_mcmarcel)
colnames(safr_rsv_incid_mcmarcel)
colnames(safr_rsv_incid_mcmarcel_kemri)
safr_rsv_incid_mcmarcel_kemri=melt(data.frame(rbind(data.frame(config$rsv_rate),data.frame(s_afr_incid_rate_matrix)),
source=array(sapply(c('mcmarcel','kemri'),function(x) {rep(x,age_maxval)})),age_mts=rep(1:age_maxval,2)),
id.vars=('age_mts','source'))
safr_rsv_incid_mcmarcel_kemri=melt(data.frame(rbind(data.frame(config$rsv_rate),data.frame(s_afr_incid_rate_matrix)),
source=array(sapply(c('mcmarcel','kemri'),function(x) {rep(x,age_maxval)})),age_mts=rep(1:age_maxval,2)),
id.vars=c('age_mts','source'))
rm(safr_rsv_incid_mcmarcel)
ggplot(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts<=12,],aes(x=value,color=source,group=source)) +
facet_wrap(~age_mts) + geom_freqpoly() + theme_bw() + standard_theme
ggplot(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts<=18,],aes(x=value,color=source,group=source)) +
facet_wrap(~age_mts) + geom_freqpoly() + theme_bw() + standard_theme
dpois(10,10)
dpois(0:20,10)
ggplot(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts<=18,],aes(x=value,color=source,group=source)) +
facet_wrap(~age_mts) + geom_freqpoly() + theme_bw() + standard_theme + ggtitle('incidence distribution for Shi_et_al vs own data')
cntr_sel
cntr_sel
paste('output/',cntr_sel,'_incidence_distrib')
paste('output/',cntr_sel,'_incidence_distrib')
paste0('output/',cntr_sel,'_incidence_distrib')
ggsave(paste0('output/',cntr_sel,'_incidence_distrib.png'),width=30,height=18,units="cm")
dim(config$rsv_rate)
library(fitdistrplus)
fitdist(config$rsv_rate[,1],distr='pois')
fitdist(config$rsv_rate[,21],distr='pois')
z=fitdist(config$rsv_rate[,21],distr='pois')
z
z=fitdist(config$rsv_rate[,21],distr='pois',method = 'mle')
z=fitdist(config$rsv_rate[,21],distr='pois',method = 'mme')
z
rpois(5000,0.0526293)
z=fitdist(config$rsv_rate[,1]*1e5,distr='pois',method = 'mme')
z=fitdist(config$rsv_rate[,1]*1e5,distr='pois',method = 'mle')
z=fitdist(config$rsv_rate[,1]*1e5,distr='pois',method = 'mme')
z
rpois(5000, 5256.057)
mean(rpois(5000, 5256.057))
sd(rpois(5000, 5256.057))
sd(rpois(5000, 5256.057))^2
sd(config$rsv_rate[1,])
sd(config$rsv_rate[1,]*1e5)
mean(config$rsv_rate[1,]*1e5)
mean(config$rsv_rate[1,]*1e5)
config$rsv_rate[1,]
config$rsv_rate[1,1:11]
mean(config$rsv_rate[1,1:11])
class(config$rsv_rate[1,1:11])
class(config$rsv_rate)
apply(config$rsv_rate,1,mean)
rbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd))
rbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,var))
class(rbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)))
data.frame(rbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)))
rownames(data.frame(rbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd))))
melt(data.frame(rbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd))))
(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd))))
(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)),age=1:60))
melt(data.frame(cbind(age=1:60,mean=apply(config$rsv_rate,1,mean),sd=apply(config$rsv_rate,1,sd))),id.vars='age')
ggplot(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)),age=1:60),aes(x=age,y=value,color=variable.names()))
ggplot(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)),age=1:60),aes(x=age,y=value,color=variable.names())) + geom_point()
ggplot(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)),age=1:60),aes(x=age,y=value,color=variable)) + geom_point()
ggplot(melt(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)),age=1:60)),
aes(x=age,y=value,color=variable)) + geom_point()
ggplot(melt(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)),age=1:60)),
aes(x=age,y=value,color=variable)) + geom_point()
ggplot(melt(data.frame(cbind(apply(config$rsv_rate,1,mean),apply(config$rsv_rate,1,sd)),age=1:60),id.vars='age'),
aes(x=age,y=value,color=variable)) + geom_point()
ggplot(melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd)),age=1:60),id.vars='age'),
aes(x=age,y=value,color=variable)) + geom_point()
data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd)),age=1:60)
data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd)),age=1:60)
ggplot(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd)),age=1:60),
aes(x=mean,y=stdev,color=age)) + geom_point()
apply(config$rsv_rate,1,sd)
ggplot(melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd)),age=1:60),id.vars='age'),
aes(x=age,y=value,color=variable)) + geom_point()
ggplot(melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
coeffvar=apply(config$rsv_rate,1,sd)/apply(config$rsv_rate,1,mean)),age=1:60),id.vars='age'),
aes(x=age,y=value,color=variable)) + geom_point()
ggplot(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd)),age=1:60),
aes(x=mean,y=stdev,color=age)) + geom_point()
dim(safr_rsv_incid_mcmarcel_kemri)
means_stdevs_incidence=rbind(melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel'),id.vars='age')),
melt(data.frame(cbind(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),
age=1:60,source='own'),id.vars='age')))
means_stdevs_incidence
ggplot(means_stdevs_incidence,aes(x=age,y=value,color=source)) + facet_wrap(~source) + geom_point()
means_stdevs_incidence
means_stdevs_incidence
means_stdevs_incidence=rbind(melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel'),id.vars='age')),
melt(data.frame(cbind(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),
age=1:60,source='own'),id.vars='age')))
means_stdevs_incidence=rbind(melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel'),id.vars=c('age','source'))),
melt(data.frame(cbind(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),
age=1:60,source='own'),id.vars=c('age','source'))) )
means_stdevs_incidence=rbind(melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel'),id.vars=c('age','source'))),
melt(data.frame(cbind(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),
age=1:60,source='own'),id.vars=c('age','source'))) )
means_stdevs_incidence
means_stdevs_incidence=rbind(
melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel')),id.vars=c('age','source')),
melt(data.frame(cbind(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),
age=1:60,source='own')),id.vars=c('age','source') ) )
melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel')),id.vars=c('age','source'))
means_stdevs_incidence=rbind(
melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel')),id.vars=c('age','source')),
melt(data.frame(cbind(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),
age=1:60,source='own')),id.vars=c('age','source') ) )
ggplot(means_stdevs_incidence,aes(x=age,y=value,color=variable)) + facet_wrap(~source) + geom_point()
ggplot(means_stdevs_incidence,aes(x=age,y=value,group=variable,color=variable)) + facet_wrap(~source) + geom_point()
means_stdevs_incidence$value
as.numeric(means_stdevs_incidence$value)
as.numeric(means_stdevs_incidence$value)
ggplot(means_stdevs_incidence,aes(x=age,y=value,group=variable,color=variable)) + facet_wrap(~source) + geom_point()
ggplot(means_stdevs_incidence,aes(x=age,y=value,group=variable,color=variable)) + facet_wrap(~source) + geom_point() +
theme_bw() + standard_theme
View(means_stdevs_incidence)
ggplot(means_stdevs_incidence,aes(x=age,y=value,group=variable,color=variable)) + facet_wrap(~source) + geom_line() +
theme_bw() + standard_theme
means_stdevs_incidence$age
means_stdevs_incidence$value=as.numeric(means_stdevs_incidence$value); means_stdevs_incidence$age=as.numeric(means_stdevs_incidence$age)
ggplot(means_stdevs_incidence,aes(x=age,y=value,group=variable,color=variable)) + facet_wrap(~source) + geom_line() +
theme_bw() + standard_theme
ggplot(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd)),age=1:60),
aes(x=mean,y=stdev,color=age)) + geom_point()
melt(data.frame(cbind(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel')),id.vars=c('age','source'))
data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel'),id.vars=c('age','source')
data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel')
melt(data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel'),id.vars=c('age','source'))
means_stdevs_incidence=rbind(
melt(data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),
age=1:60,source='mcmarcel'),id.vars=c('age','source')),
melt(data.frame(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),
age=1:60,source='own'),id.vars=c('age','source') ) )
ggplot(means_stdevs_incidence,aes(x=age,y=value,group=variable,color=variable)) + facet_wrap(~source) + geom_line() +
theme_bw() + standard_theme
data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),age=1:60)
data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),age=1:60)
means_stdevs_incidence=rbind(data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),age=1:60,source='mcmarcel'),
data.frame(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),age=1:60,source='own'))
means_stdevs_incidence=rbind(data.frame(mean=apply(config$rsv_rate,1,mean),stdev=apply(config$rsv_rate,1,sd),age=1:60,source='mcmarcel'),
data.frame(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),age=1:60,source='own'))
means_stdevs_incidence
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_point()
melt(means_stdevs_incidence,id.vars=c('age','source'))
melt(means_stdevs_incidence,id.vars=c('age','source'))
ggplot(melt(means_stdevs_incidence,id.vars=c('age','source')),aes(x=age,y=value,group=variable,color=variable)) + facet_wrap(~source) + geom_line() +
theme_bw() + standard_theme
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_point()
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_point()
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_path()
means_stdevs_incidence=rbind(data.frame(mean=apply(config$rsv_rate,1,mean),
stdev=apply(config$rsv_rate,1,sd),coeffvar=apply(config$rsv_rate,1,sd)/apply(config$rsv_rate,1,mean),age=1:60,source='mcmarcel'),
data.frame(mean=apply(s_afr_incid_rate_matrix,1,mean),stdev=apply(s_afr_incid_rate_matrix,1,sd),age=1:60,source='own'))
means_stdevs_incidence=rbind(data.frame(mean=apply(config$rsv_rate,1,mean),
stdev=apply(config$rsv_rate,1,sd),coeffvar=apply(config$rsv_rate,1,sd)/apply(config$rsv_rate,1,mean),age=1:60,source='mcmarcel'),
data.frame(mean=apply(s_afr_incid_rate_matrix,1,mean),
stdev=apply(s_afr_incid_rate_matrix,1,sd),coeffvar=apply(config$rsv_rate,1,sd)/apply(config$rsv_rate,1,mean),age=1:60,source='own'))
means_stdevs_incidence=rbind(data.frame(mean=apply(config$rsv_rate,1,mean),
stdev=apply(config$rsv_rate,1,sd),coeffvar=apply(config$rsv_rate,1,sd)/apply(config$rsv_rate,1,mean),age=1:60,source='mcmarcel'),
data.frame(mean=apply(s_afr_incid_rate_matrix,1,mean),
stdev=apply(s_afr_incid_rate_matrix,1,sd),coeffvar=apply(config$rsv_rate,1,sd)/apply(config$rsv_rate,1,mean),age=1:60,source='own'))
ggplot(means_stdevs_incidence, aes(x=mean,y=coeffvar,color=age)) + facet_wrap(~source) + geom_path()
ggplot(life_table_tidy,aes(x=age,y=value,group=disc_rate,color=factor(disc_rate),linetype=factor(disc_rate))) + geom_line(size=1.2) +
facet_wrap(~variable_expl,scales='free') + theme_bw() + standard_theme + xlab('age (in months)') + ylab('') +
ggtitle(paste(cntr_sel,'demographics')) + labs(color='discount rate',linetype='discount rate')
ggsave(paste0("output/life_table_",f_country_iso,"_2020_2025_disc0p03.png"),width=30,height=18,units="cm")
ggplot(melt(means_stdevs_incidence,id.vars=c('age','source')),aes(x=age,y=value,group=variable,color=variable)) +
facet_wrap(~source) + geom_line() + theme_bw() + standard_theme
f_country_iso
f_country_iso
paste0(f_country_iso,'incid_randomsamples_mean_stdev_coeffvar.png')
paste0(f_country_iso,'_incid_randomsamples_mean_stdev_coeffvar.png')
ggsave(paste0(f_country_iso,'_incid_randomsamples_mean_stdev_coeffvar.png'),width=30,height=18,units="cm")
ggsave(paste0('output/',f_country_iso,'_incid_randomsamples_mean_stdev_coeffvar.png'),width=30,height=18,units="cm")
View(means_stdevs_incidence)
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_path() + theme_bw() + standard_theme
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_path() + theme_bw() + standard_theme +
ggitle('incidence random samples')
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_path() + theme_bw() + standard_theme +
ggtitle('incidence random samples')
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_path(size=1.2) +
theme_bw() + standard_theme + ggtitle('incidence random samples')
ggsave(paste0('output/',f_country_iso,'_incid_randomsamples_mean_stdev.png'),width=30,height=18,units="cm")
fitdist(config$rsv_rate[,1],distr='pois')
fitdist(config$rsv_rate[,1],distr='gamma')
fitdist(config$rsv_rate[,1]*1e5,distr='gamma')
fitdist(config$rsv_rate[,1],distr='gamma')
ggplot(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts<=18,],aes(x=value,color=source,group=source)) +
facet_wrap(~age_mts) + geom_freqpoly() + theme_bw() + standard_theme + ggtitle('incidence distribution for Shi_et_al vs own data')
incid_params=fitdist(config$rsv_rate[,1],distr='gamma')
incid_params
incid_params$estimate
incid_params$loglik
incid_params$cor
incid_params$estimate
incid_params$estimate
class(incid_params$estimate)
incid_params$estimate['shape']
rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])
class(rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']))
incid_simul=data.frame(rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']))
s_afr_incidence_data
class(incid_simul)
incid_simul
incid_simul=data.frame(simulvals=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']))
head(incid_simul)
head(incid_simul)
ggplot(incid_simul,aes(x=incid_simul)) + geom_freqpoly()
ggplot(incid_simul,aes(x=incid_simul)) + geom_freqpoly()
max(config$rsv_rate)
min(config$rsv_rate)
ggplot(incid_simul,aes(x=incid_simul)) + geom_hist()
ggplot(incid_simul,aes(x=incid_simul)) + geom_histogram()
ggplot(incid_simul,aes(x=incid_simul)) + geom_histogram()
ggplot(incid_simul,aes(x=simulvals)) + geom_histogram()
head(safr_rsv_incid_mcmarcel_kemri,4)
dim(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts==1 & safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',])
ggplot(incid_simul,aes(x=value)) + geom_freqpoly()
ggplot(incid_simul,aes(x=value)) + geom_freqpoly()
head(incid_simul)
incid_simul=data.frame(value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']))
ggplot(incid_simul,aes(x=value)) + geom_freqpoly()
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts==1 & safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel','value'],incid_simul)
incid_simul=data.frame(value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']),source='simul')
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts==1 &
safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',c('source','value')],incid_simul)
incid_simul=data.frame(value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']),source='simul')
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts==1 &
safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',c('source','value')],incid_simul)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly()
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=10)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=30)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=30)
incid_params=fitdist(config$rsv_rate[,7],distr='gamma')
incid_params
sel_age=7; incid_params=fitdist(config$rsv_rate[,sel_age],distr='gamma')
incid_simul=data.frame(value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']),source='simul')
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts==sel_age &
safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',c('source','value')],incid_simul)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=30)
mean(incid_params)
mean(incid_simul)
mean(incid_simul)
incid_simul[1:11]
View(incid_simul)
mean(incid_simul$value)
dim(config$rsv_rate[,sel_age])
length(config$rsv_rate[,sel_age])
sel_age=7; incid_params=fitdist(config$rsv_rate[sel_age,],distr='gamma')
config$rsv_rate[sel_age,]
length(config$rsv_rate[sel_age,])
config$rsv_rate[sel_age,1:11]
dim(config$rsv_rate[sel_age,])
class(config$rsv_rate[sel_age,])
array(config$rsv_rate[sel_age,])
length(array(config$rsv_rate[sel_age,]))
array(config$rsv_rate[sel_age,])[1:11]
sel_age=7; incid_params=fitdist(config$rsv_rate[sel_age,],distr='gamma')
sel_age=7; incid_params=fitdist(array(config$rsv_rate[sel_age,]),distr='gamma')
sel_age=7; incid_params=fitdist(array(config$rsv_rate[sel_age,]),distr='gamma')
sel_age
View(config$rsv_rate[sel_age,])
dim(config$rsv_rate[sel_age,])
class(config$rsv_rate[sel_age,])
class(array(config$rsv_rate[sel_age,]))
class(as.array(config$rsv_rate[sel_age,]))
sel_age=7; incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma')
incid_params
incid_simul=data.frame(value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']),source='simul')
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts==sel_age &
safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',c('source','value')],incid_simul)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=30)
sel_age=1; incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma')
incid_simul=data.frame(value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']),source='simul')
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts==sel_age &
safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',c('source','value')],incid_simul)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=30)
colnames(safr_rsv_incid_mcmarcel_kemri)
colnames(safr_rsv_incid_mcmarcel_kemri)
incid_simul=data.frame()
incid_simul=data.frame()
incid_simul
incid_simul=rbind(incid_simul,data.frame(age_mts=,sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])))
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])))
for (sel_age in 1:12){
incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma'); if (sel_age==1) {incid_simul=data.frame()}
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])))
}
dim(incid_simul)
head(incid_simul)
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts<=12 &
safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',c('age_mts','source','value')],incid_simul)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=30) + facet_wrap(~age_mts)
ggplot(dataplot,aes(x=value,color=source)) + geom_freqpoly(bins=30) + facet_wrap(~age_mts) + theme_bw() + standard_theme
ggplot(dataplot,aes(x=value,color=source,linetype=source)) + geom_freqpoly(bins=30) + facet_wrap(~age_mts) +
theme_bw() + standard_theme
incid_params
ggsave(paste0('output/',f_country_iso,'_gamma_fit.png'),width=30,height=18,units="cm")
ggplot(dataplot,aes(x=value,color=source,linetype=source)) + geom_freqpoly(size=1.2,bins=30) + facet_wrap(~age_mts) +
theme_bw() + standard_theme
ggsave(paste0('output/',f_country_iso,'_gamma_fit.png'),width=30,height=18,units="cm")
incid_params
incid_params$estimate
incid_params$estimate['shape']
rmarkdown::render("RSV_kenya_SA_calculation.R",'output/RSV_kenya_SA_calculation.html')
rmarkdown::render("RSV_kenya_SA_calculation.R",output_file='output/cea_plots/RSV_kenya_SA_calculation.html')
rmarkdown::render("RSV_kenya_SA_calculation.R",output_file='output/cea_plots/RSV_kenya_SA_calculation.html')
rmarkdown::render("RSV_kenya_SA_calculation.R",output_file='output/cea_plots/RSV_kenya_SA_calculation.html')
rmarkdown::render("RSV_kenya_SA_calculation.R",'output/RSV_kenya_SA_calculation.html')
#+ fig.width=15, fig.height=10
rmarkdown::render("RSV_kenya_SA_calculation.R",'output/RSV_kenya_SA_calculation.html')
rmarkdown::render("RSV_kenya_SA_calculation.R",output_file='output/cea_plots/RSV_kenya_SA_calculation.html')
#+ fig.width=15, fig.height=10
for (sel_age in 1:12){
incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma'); if (sel_age==1) {incid_simul=data.frame()}
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']),
shape=incid_params$estimate['shape'],rate=incid_params$estimate['rate']))
}
incid_simul
head(incid_simul)
View(incid_simul)
incid_params$estimate['shape']
as.numeric(incid_params$estimate['shape'])
for (sel_age in 1:12){
incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma'); if (sel_age==1) {incid_simul=data.frame()}
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate']),
shape=as.numeric(incid_params$estimate['shape']),rate=as.numeric(incid_params$estimate['rate']))) }
dataplot=rbind(safr_rsv_incid_mcmarcel_kemri[safr_rsv_incid_mcmarcel_kemri$age_mts<=12 &
safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel',c('age_mts','source','value')],incid_simul)
ggplot(dataplot,aes(x=value,color=source,linetype=source)) + geom_freqpoly(size=1.2,bins=30) + facet_wrap(~age_mts) +
theme_bw() + standard_theme
colnames(safr_rsv_incid_mcmarcel_kemri)
colnames(incid_simul)
rowsel=safr_rsv_incid_mcmarcel_kemri$age_mts<=12 & safr_rsv_incid_mcmarcel_kemri$source %in% 'mcmarcel'
rowsel
c(as.numeric(incid_params$estimate['shape']),as.numeric(incid_params$estimate['rate']))
c(as.numeric(incid_params$estimate['shape']),as.numeric(incid_params$estimate['rate']))
c(sel_age,as.numeric(incid_params$estimate['shape']),as.numeric(incid_params$estimate['rate']))
c(sel_age,as.numeric(incid_params$estimate['shape']),as.numeric(incid_params$estimate['rate']))
for (sel_age in 1:12){
incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma')
if (sel_age==1) {incid_simul=data.frame();shape_rate_param_est=data.frame()}
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])))
shape_rate_param_est=rbind(shape_rate_param_est,
c(sel_age,as.numeric(incid_params$estimate['shape']),as.numeric(incid_params$estimate['rate']))) }
shape_rate_param_est
shape_rate_param_est
for (sel_age in 1:12){
incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma')
if (sel_age==1) {incid_simul=data.frame();shape_rate_param_est=data.frame();
colnames(shape_rate_param_est)=c('age_mts','shape','rate')}
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])))
shape_rate_param_est=rbind(shape_rate_param_est,
c(sel_age,as.numeric(incid_params$estimate['shape']),as.numeric(incid_params$estimate['rate']))) }
shape_rate_param_est
colnames(shape_rate_param_est)
colnames(shape_rate_param_est)=c('age_mts','shape','rate')
for (sel_age in 1:12){
incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma')
if (sel_age==1) {incid_simul=data.frame(); shape_rate_param_est=data.frame()}
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])))
shape_rate_param_est=rbind(shape_rate_param_est,
c(sel_age,as.numeric(incid_params$estimate['shape']),as.numeric(incid_params$estimate['rate']))) }
colnames(shape_rate_param_est)=c('age_mts','shape','rate')
colnames(shape_rate_param_est)
shape_rate_param_est
mean(as.numeric(config$rsv_rate[sel_age,]))
mean(as.numeric(config$rsv_rate[sel_age,]))
shape_rate_param_est
shape_rate_param_est
shape_rate_param_est
ggplot(means_stdevs_incidence, aes(x=mean,y=stdev,color=age)) + facet_wrap(~source) + geom_path(size=1.2) +
theme_bw() + standard_theme + ggtitle('incidence random samples')
means_stdevs_incidence
for (sel_age in 1:age_maxval){
incid_params=fitdist(as.numeric(config$rsv_rate[sel_age,]),distr='gamma')
if (sel_age==1) {incid_simul=data.frame(); shape_rate_param_est=data.frame()}
incid_simul=rbind(incid_simul,data.frame(age_mts=sel_age,source='simul',
value=rgamma(5000,shape=incid_params$estimate['shape'],incid_params$estimate['rate'])))
shapeval=as.numeric(incid_params$estimate['shape']); rateval=as.numeric(incid_params$estimate['rate'])
# mean(as.numeric(config$rsv_rate[sel_age,]))
shape_rate_param_est=rbind(shape_rate_param_est, c(sel_age,shapeval,rateval)) }
View(shape_rate_param_est)
colnames(shape_rate_param_est)=c('age_mts','shape','rate')
head(means_stdevs_incidence)
head(means_stdevs_incidence)
head(shape_rate_param_est)
colnames(means_stdevs_incidence)
sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate)
sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate)
sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate
rbind(means_stdevs_incidence[,c("age","mean","stdev","source")],
data.frame(age=shape_rate_param_est$age_mts,mean=shape_rate_param_est$shape/shape_rate_param_est$rate,
stdev=sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate,source='pred_gamma_distrib'))
rbind(means_stdevs_incidence[,c("age","mean","stdev","source")],
data.frame(age=shape_rate_param_est$age_mts,mean=shape_rate_param_est$shape/shape_rate_param_est$rate,
stdev=sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate,source='pred_gamma_distrib'))
rbind(means_stdevs_incidence[means_stdevs_incidence$source %in% 'mcmarcel',c("age","mean","stdev","source")],
data.frame(age=shape_rate_param_est$age_mts,mean=shape_rate_param_est$shape/shape_rate_param_est$rate,
stdev=sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate,source='pred_gamma_distrib'))
rbind(means_stdevs_incidence[means_stdevs_incidence$source %in% 'mcmarcel',c("age","mean","stdev","source")],
data.frame(age=shape_rate_param_est$age_mts,mean=shape_rate_param_est$shape/shape_rate_param_est$rate,
stdev=sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate,source='pred_gamma_distrib'))
ggplot(melt(means_stdevs_incidence,id.vars=c('age','source')),aes(x=age,y=value,group=variable,color=variable)) +
facet_wrap(~source) + geom_line() + theme_bw() + standard_theme + ggtitle()
means_stdevs_incidence_gammafit=rbind(
means_stdevs_incidence[means_stdevs_incidence$source %in% 'mcmarcel',c("age","mean","stdev","source")],
data.frame(age=shape_rate_param_est$age_mts,mean=shape_rate_param_est$shape/shape_rate_param_est$rate,
stdev=sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate,source='pred_gamma_distrib'))
means_stdevs_incidence_gammafit=rbind(
means_stdevs_incidence[means_stdevs_incidence$source %in% 'mcmarcel',c("age","mean","stdev","source")],
data.frame(age=shape_rate_param_est$age_mts,mean=shape_rate_param_est$shape/shape_rate_param_est$rate,
stdev=sqrt(shape_rate_param_est$shape)/shape_rate_param_est$rate,source='pred_gamma_distrib'))
View(melt(means_stdevs_incidence_gammafit,id.vars =c('age','source')))
ggplot(melt(means_stdevs_incidence_gammafit,id.vars =c('age','source')),aes(x=age,y=value,color=source)) +
geom_line() + facet_wrap(~variable) + theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars =c('age','source')),aes(x=age,y=value,color=source)) +
geom_line() + facet_wrap(~variable) + theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line() + facet_wrap(~variable) + theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line() + facet_wrap(~variable,nrow=2) + theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line() + facet_wrap(~variable,nrow=2,scales='free') + theme_bw() + standard_theme
ggsave(paste0('output/',f_country_iso,'_incid_randomsamples_mean_stdev_fit_gammadistrib.png'),width=30,height=18,units="cm")
View(means_stdevs_incidence_gammafit)
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + facet_wrap(~variable,nrow=2,scales='free') + theme_bw() + standard_theme
ggsave(paste0('output/',f_country_iso,'_incid_randomsamples_mean_stdev_fit_gammadistrib.png'),width=30,height=18,units="cm")
source('functions/GammaParmsFromQuantiles.R')
ggplot(life_table_tidy,aes(x=age,y=value,group=disc_rate,color=factor(disc_rate),linetype=factor(disc_rate))) +
geom_line(size=1.2) + geom_point() + facet_wrap(~variable_expl,scales='free') +
theme_bw() + standard_theme + xlab('age (in months)') + ylab('') +
ggtitle(paste(cntr_sel,'demographics')) + labs(color='discount rate',linetype='discount rate')
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + + geom_point() + facet_wrap(~variable,nrow=2,scales='free') + theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + geom_point() + facet_wrap(~variable,nrow=2,scales='free') + theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + geom_point(fill=NA) + facet_wrap(~variable,nrow=2,scales='free') + theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + geom_point(aes(shape=source),fill=NA) + facet_wrap(~variable,nrow=2,scales='free') +
theme_bw() + standard_theme
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + facet_wrap(~variable,nrow=2,scales='free') + # geom_point(aes(shape=source),fill=NA) +
theme_bw() + standard_theme
stdev_est
CI95_const
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + facet_wrap(~variable,nrow=2,scales='free') + # geom_point(aes(shape=source),fill=NA) +
theme_bw() + standard_theme + xlab('age (months') + ylab('')
ggsave(paste0('output/',f_country_iso,'_incid_randomsamples_mean_stdev_fit_gammadistrib.png'),width=30,height=18,units="cm")
ggplot(melt(means_stdevs_incidence_gammafit,id.vars=c('age','source')),aes(x=age,y=value,color=source,linetype=source)) +
geom_line(size=1.2) + facet_wrap(~variable,nrow=2,scales='free') + # geom_point(aes(shape=source),fill=NA) +
scale_x_continuous(labels=as.character(seq(0,age_maxval,4)),breaks=seq(0,age_maxval,4)) +
theme_bw() + standard_theme + xlab('age (months') + ylab('')
ggsave(paste0('output/',f_country_iso,'_incid_randomsamples_mean_stdev_fit_gammadistrib.png'),width=30,height=18,units="cm")
kemri_rsv_incidence_per_capita
kemri_rsv_incidence_per_capita
kemri_rsv_incidence_per_capita
kemri_rsv_incidence_CIs
kemri_rsv_incidence_per_capita
kemri_rsv_incidence_per_capita
kemri_rsv_incidence_per_capita
